<!DOCTYPE html>
<html lang="zh-CN">
<!--
  è¶…å¼ºé˜²å°ç³»ç»Ÿ - æ™ºèƒ½éšæœºåŒ–è·³è½¬é¡µé¢
  å¼€å‘è€…ï¼šä¼Ÿå¤§çš„ä¼Ÿ
  ç‰ˆæœ¬ï¼šv3.0 - è‡ªåŠ¨éšæœºåŒ–ç‰ˆ
  ä¿®æ”¹æ—¥æœŸï¼š2025-10-07
  
  âš¡ ç‰¹æ€§ï¼š
  - æ¯æ¬¡è®¿é—®è‡ªåŠ¨éšæœºåŒ–é¡µé¢ç‰¹å¾
  - é˜²æ­¢ç‰¹å¾è¯†åˆ«å’Œå°ç¦
  - æ™ºèƒ½åçˆ¬è™«æœºåˆ¶
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title id="page-title">åŠ è½½ä¸­...</title>
    <style id="dynamic-styles">
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }
        
        .container {
            text-align: center;
            padding: 40px;
            max-width: 400px;
            position: relative;
            z-index: 10;
        }
        
        .logo {
            width: var(--logo-size);
            height: var(--logo-size);
            margin: 0 auto 20px;
            background: white;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--icon-size);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: pulse var(--pulse-duration) ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(var(--pulse-scale)); }
        }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: var(--spinner-size);
            height: var(--spinner-size);
            animation: spin var(--spin-duration) linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        h1 {
            font-size: var(--title-size);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        #status {
            opacity: 0.9;
            font-size: var(--text-size);
            line-height: 1.6;
        }
        
        .error {
            color: #fff;
            background: rgba(255, 107, 107, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .error-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: var(--progress-height);
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            animation: progress var(--progress-duration) ease-out forwards;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: var(--particle-size);
            height: var(--particle-size);
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            animation: float var(--float-duration) infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(100px); opacity: 0; }
        }
        
        .safe-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(16, 185, 129, 0.2);
            padding: var(--badge-padding);
            border-radius: 20px;
            font-size: var(--badge-size);
            margin-top: 10px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .safe-icon {
            width: 16px;
            height: 16px;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯ç²’å­æ•ˆæœ -->
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <div class="logo" id="logo-icon">ğŸ”</div>
        <div class="spinner"></div>
        <h1 id="main-title">å®‰å…¨è·³è½¬ä¸­</h1>
        <p id="status">æ­£åœ¨éªŒè¯é“¾æ¥å®‰å…¨æ€§...</p>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <div class="safe-badge" id="badge">
            <svg class="safe-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span id="badge-text">å·²åŠ å¯†ä¿æŠ¤</span>
        </div>
    </div>
    
    <script>
        // ==================== ğŸ² éšæœºåŒ–å¼•æ“ ====================
        const RandomEngine = {
            // éšæœºæ•´æ•°
            int(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            },
            
            // éšæœºæµ®ç‚¹æ•°
            float(min, max, decimals = 2) {
                return parseFloat((Math.random() * (max - min) + min).toFixed(decimals));
            },
            
            // éšæœºé€‰æ‹©
            pick(array) {
                return array[Math.floor(Math.random() * array.length)];
            },
            
            // éšæœºé¢œè‰²
            color() {
                return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
            },
            
            // éšæœºæ¸å˜
            gradient() {
                const gradients = [
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
                    'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                    'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
                    'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
                    'linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%)',
                    'linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)',
                    'linear-gradient(135deg, #f68084 0%, #fccb90 100%)',
                    'linear-gradient(135deg, #fdcbf1 0%, #e6dee9 100%)',
                    'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
                    'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
                    'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)',
                    'linear-gradient(135deg, #fddb92 0%, #d1fdff 100%)',
                    'linear-gradient(135deg, #9890e3 0%, #b1f4cf 100%)',
                    'linear-gradient(135deg, #ebc0fd 0%, #d9ded8 100%)',
                    'linear-gradient(135deg, #96fbc4 0%, #f9f586 100%)'
                ];
                return this.pick(gradients);
            },
            
            // éšæœºæ ‡é¢˜
            title() {
                const titles = [
                    'æ­£åœ¨è·³è½¬...', 'å®‰å…¨è·³è½¬ä¸­', 'é“¾æ¥éªŒè¯ä¸­', 'åŠ è½½ä¸­...',
                    'é¡µé¢è·³è½¬', 'æ­£åœ¨è¿æ¥', 'å®‰å…¨è®¿é—®', 'éªŒè¯ä¸­...',
                    'è·³è½¬å¤„ç†ä¸­', 'é“¾æ¥åŠ è½½ä¸­', 'å®‰å…¨æ£€æµ‹ä¸­', 'å³å°†è·³è½¬',
                    'å¤„ç†ä¸­...', 'è®¿é—®éªŒè¯', 'é“¾æ¥è§£æä¸­', 'æ­£åœ¨åŠ è½½'
                ];
                return this.pick(titles);
            },
            
            // éšæœºä¸»æ ‡é¢˜
            mainTitle() {
                const titles = [
                    'å®‰å…¨è·³è½¬ä¸­', 'æ­£åœ¨è·³è½¬', 'é“¾æ¥éªŒè¯ä¸­', 'åŠ è½½ä¸­',
                    'é¡µé¢è·³è½¬', 'å®‰å…¨è®¿é—®', 'éªŒè¯ä¸­', 'å³å°†è·³è½¬',
                    'æ­£åœ¨å¤„ç†', 'é“¾æ¥åŠ è½½', 'å®‰å…¨æ£€æµ‹', 'è·³è½¬ä¸­'
                ];
                return this.pick(titles);
            },
            
            // éšæœºå¾½ç« æ–‡å­—
            badgeText() {
                const badges = [
                    'å·²åŠ å¯†ä¿æŠ¤', 'å®‰å…¨é“¾æ¥', 'å·²éªŒè¯', 'å®‰å…¨è®¿é—®',
                    'åŠ å¯†ä¼ è¾“', 'å®‰å…¨ä¿éšœ', 'å·²è®¤è¯', 'å®‰å…¨è¿æ¥',
                    'é˜²æŠ¤ä¸­', 'ä¿æŠ¤ä¸­', 'åŠ å¯†ä¸­', 'å®‰å…¨é€šé“'
                ];
                return this.pick(badges);
            },
            
            // éšæœºå›¾æ ‡
            icon() {
                const icons = ['ğŸ”', 'ğŸ”’', 'âœ“', 'âœ”ï¸', 'ğŸ›¡ï¸', 'âš¡', 'ğŸ”‘', 'â­', 'ğŸ’«', 'ğŸŒŸ'];
                return this.pick(icons);
            },
            
            // éšæœºCSSå˜é‡
            cssVars() {
                return {
                    '--bg-gradient': this.gradient(),
                    '--logo-size': this.int(70, 90) + 'px',
                    '--border-radius': this.int(15, 25) + 'px',
                    '--icon-size': this.int(35, 45) + 'px',
                    '--pulse-duration': this.float(1.5, 2.5) + 's',
                    '--pulse-scale': this.float(1.03, 1.08),
                    '--spinner-size': this.int(45, 55) + 'px',
                    '--spin-duration': this.float(0.8, 1.2) + 's',
                    '--title-size': this.int(22, 26) + 'px',
                    '--text-size': this.int(13, 15) + 'px',
                    '--progress-height': this.int(3, 5) + 'px',
                    '--progress-duration': this.float(1.8, 2.5) + 's',
                    '--particle-size': this.int(8, 12) + 'px',
                    '--float-duration': this.int(12, 18) + 's',
                    '--badge-padding': this.int(5, 8) + 'px ' + this.int(10, 14) + 'px',
                    '--badge-size': this.int(11, 13) + 'px'
                };
            }
        };
        
        // ==================== ğŸ¨ åº”ç”¨éšæœºåŒ– ====================
        function applyRandomization() {
            // 1. éšæœºåŒ–CSSå˜é‡
            const cssVars = RandomEngine.cssVars();
            const root = document.documentElement;
            Object.entries(cssVars).forEach(([key, value]) => {
                root.style.setProperty(key, value);
            });
            
            // 2. éšæœºåŒ–é¡µé¢æ ‡é¢˜
            document.getElementById('page-title').textContent = RandomEngine.title();
            
            // 3. éšæœºåŒ–ä¸»æ ‡é¢˜
            document.getElementById('main-title').textContent = RandomEngine.mainTitle();
            
            // 4. éšæœºåŒ–å¾½ç« æ–‡å­—
            document.getElementById('badge-text').textContent = RandomEngine.badgeText();
            
            // 5. éšæœºåŒ–å›¾æ ‡
            document.getElementById('logo-icon').textContent = RandomEngine.icon();
            
            // 6. éšæœºåŒ–ç²’å­æ•°é‡
            const particleCount = RandomEngine.int(15, 30);
            createParticles(particleCount);
            
            // 7. éšæœºåŒ–è·³è½¬å»¶è¿Ÿ
            CONFIG.REDIRECT_DELAY = RandomEngine.int(600, 1200);
            
            // 8. éšæœºåŒ–çŠ¶æ€æ–‡æœ¬
            randomizeStatusTexts();
            
            // 9. éšæœºåŒ–metaæ ‡ç­¾
            randomizeMetaTags();
            
            console.log('ğŸ² éšæœºåŒ–å·²åº”ç”¨', cssVars);
        }
        
        // ==================== ğŸ“ éšæœºåŒ–çŠ¶æ€æ–‡æœ¬ ====================
        const statusTexts = {
            checking: [
                'æ­£åœ¨æ£€æµ‹æµè§ˆå™¨ç¯å¢ƒ...', 'éªŒè¯è¿è¡Œç¯å¢ƒ...', 'ç¯å¢ƒæ£€æµ‹ä¸­...',
                'æµè§ˆå™¨éªŒè¯ä¸­...', 'å®‰å…¨æ£€æµ‹ä¸­...', 'ç¯å¢ƒåˆ†æä¸­...'
            ],
            parsing: [
                'æ­£åœ¨è§£æé“¾æ¥...', 'é“¾æ¥åˆ†æä¸­...', 'è§£ææ•°æ®ä¸­...',
                'æ•°æ®å¤„ç†ä¸­...', 'é“¾æ¥éªŒè¯ä¸­...', 'è§£æä¸­...'
            ],
            decrypting: [
                'æ­£åœ¨è§£å¯†æ•°æ®...', 'æ•°æ®è§£å¯†ä¸­...', 'å®‰å…¨è§£å¯†ä¸­...',
                'è§£å¯†å¤„ç†ä¸­...', 'éªŒè¯æ•°æ®ä¸­...', 'è§£å¯†ä¸­...'
            ],
            verifying: [
                'æ­£åœ¨éªŒè¯é“¾æ¥æœ‰æ•ˆæœŸ...', 'æœ‰æ•ˆæœŸæ£€æµ‹ä¸­...', 'æ—¶é—´éªŒè¯ä¸­...',
                'æœ‰æ•ˆæ€§æ£€æŸ¥ä¸­...', 'é“¾æ¥éªŒè¯ä¸­...', 'æ£€æŸ¥ä¸­...'
            ],
            signature: [
                'æ­£åœ¨éªŒè¯ç­¾å...', 'ç­¾åæ£€æµ‹ä¸­...', 'å®‰å…¨éªŒè¯ä¸­...',
                'ç­¾åéªŒè¯ä¸­...', 'å®Œæ•´æ€§æ£€æŸ¥ä¸­...', 'éªŒè¯ä¸­...'
            ],
            validating: [
                'æ­£åœ¨éªŒè¯ç›®æ ‡åœ°å€...', 'åœ°å€éªŒè¯ä¸­...', 'ç›®æ ‡æ£€æµ‹ä¸­...',
                'URLéªŒè¯ä¸­...', 'åœ°å€æ£€æŸ¥ä¸­...', 'éªŒè¯ä¸­...'
            ],
            wechat: [
                'å»ºè®®åœ¨å¾®ä¿¡ä¸­æ‰“å¼€', 'æ¨èä½¿ç”¨å¾®ä¿¡è®¿é—®', 'å¾®ä¿¡ä¸­ä½“éªŒæ›´ä½³',
                'è¯·åœ¨å¾®ä¿¡ä¸­æ‰“å¼€', 'å¾®ä¿¡è®¿é—®æ›´å®‰å…¨', 'å»ºè®®å¾®ä¿¡æ‰“å¼€'
            ]
        };
        
        function randomizeStatusTexts() {
            // ç¼“å­˜éšæœºæ–‡æœ¬ä¾›åç»­ä½¿ç”¨
            window._randomTexts = {
                checking: RandomEngine.pick(statusTexts.checking),
                parsing: RandomEngine.pick(statusTexts.parsing),
                decrypting: RandomEngine.pick(statusTexts.decrypting),
                verifying: RandomEngine.pick(statusTexts.verifying),
                signature: RandomEngine.pick(statusTexts.signature),
                validating: RandomEngine.pick(statusTexts.validating),
                wechat: RandomEngine.pick(statusTexts.wechat)
            };
        }
        
        // ==================== ğŸ·ï¸ éšæœºåŒ–Metaæ ‡ç­¾ ====================
        function randomizeMetaTags() {
            const descriptions = [
                'å®‰å…¨é“¾æ¥è·³è½¬æœåŠ¡', 'æ™ºèƒ½é“¾æ¥ä¸­è½¬', 'å®‰å…¨è®¿é—®é€šé“',
                'é“¾æ¥å®‰å…¨éªŒè¯', 'åŠ å¯†é“¾æ¥æœåŠ¡', 'å®‰å…¨è·³è½¬ä¸­å¿ƒ',
                'æ™ºèƒ½è·³è½¬æœåŠ¡', 'é“¾æ¥ä¿æŠ¤ç³»ç»Ÿ', 'å®‰å…¨è®¿é—®æœåŠ¡'
            ];
            
            const keywords = [
                'è·³è½¬,å®‰å…¨,é“¾æ¥', 'ä¸­è½¬,éªŒè¯,åŠ å¯†', 'å®‰å…¨,è®¿é—®,ä¿æŠ¤',
                'è·³è½¬,æ™ºèƒ½,å®‰å…¨', 'é“¾æ¥,é˜²æŠ¤,ä¸­è½¬', 'å®‰å…¨,éªŒè¯,è·³è½¬'
            ];
            
            // åˆ›å»ºæˆ–æ›´æ–°description
            let metaDesc = document.querySelector('meta[name="description"]');
            if (!metaDesc) {
                metaDesc = document.createElement('meta');
                metaDesc.name = 'description';
                document.head.appendChild(metaDesc);
            }
            metaDesc.content = RandomEngine.pick(descriptions);
            
            // åˆ›å»ºæˆ–æ›´æ–°keywords
            let metaKeywords = document.querySelector('meta[name="keywords"]');
            if (!metaKeywords) {
                metaKeywords = document.createElement('meta');
                metaKeywords.name = 'keywords';
                document.head.appendChild(metaKeywords);
            }
            metaKeywords.content = RandomEngine.pick(keywords);
        }
        
        // ==================== é…ç½® ====================
        const CONFIG = {
            ENCRYPT_KEY: 'MH-ANTI-BLOCK-2024',  // å¿…é¡»ä¸åç«¯ä¸€è‡´
            LINK_EXPIRE_TIME: 24 * 60 * 60 * 1000, // é“¾æ¥æœ‰æ•ˆæœŸï¼ˆ24å°æ—¶ï¼‰
            REDIRECT_DELAY: 800, // è·³è½¬å»¶è¿Ÿï¼ˆä¼šè¢«éšæœºåŒ–ï¼‰
            ENABLE_WECHAT_CHECK: true, // æ˜¯å¦å¯ç”¨å¾®ä¿¡æ£€æµ‹
            ENABLE_EXPIRE_CHECK: true, // æ˜¯å¦å¯ç”¨è¿‡æœŸæ£€æµ‹
            ENABLE_SIGNATURE_CHECK: true, // æ˜¯å¦å¯ç”¨ç­¾åéªŒè¯
        };
        
        // ==================== ç«‹å³åº”ç”¨éšæœºåŒ– ====================
        applyRandomization();
        
        // ==================== é˜²è°ƒè¯• ====================
        (function preventDebug() {
            // ç¦ç”¨å³é”®
            document.addEventListener('contextmenu', e => e.preventDefault());
            
            // ç¦ç”¨F12å’Œå¿«æ·é”®
            document.addEventListener('keydown', e => {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key)) ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                }
            });
            
            // æ£€æµ‹å¼€å‘è€…å·¥å…·
            const devtools = /./;
            devtools.toString = function() { this.opened = true; }
            const checkInterval = RandomEngine.int(800, 1500); // éšæœºæ£€æµ‹é—´éš”
            setInterval(() => {
                console.log(devtools);
                if (devtools.opened) {
                    // æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·
                }
            }, checkInterval);
        })();
        
        // ==================== èƒŒæ™¯ç²’å­æ•ˆæœ ====================
        function createParticles(count = 20) {
            const container = document.getElementById('particles');
            container.innerHTML = ''; // æ¸…ç©º
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = RandomEngine.float(0, 15) + 's';
                particle.style.animationDuration = RandomEngine.float(12, 20) + 's';
                particle.style.opacity = RandomEngine.float(0.3, 0.7);
                container.appendChild(particle);
            }
        }
        
        // ==================== User-Agent æ£€æµ‹ ====================
        function getUserAgent() {
            const ua = navigator.userAgent.toLowerCase();
            return {
                isWeChat: /micromessenger/i.test(ua),
                isQQ: /qq\//i.test(ua),
                isWeibo: /weibo/i.test(ua),
                isAndroid: /android/i.test(ua),
                isIOS: /iphone|ipad|ipod/i.test(ua),
                isMobile: /mobile/i.test(ua) || /android/i.test(ua) || /iphone|ipad|ipod/i.test(ua),
                full: ua
            };
        }
        
        // ==================== URLå‚æ•°è·å– ====================
        function getUrlParam() {
            // æ”¯æŒå¤šç§å‚æ•°å
            const params = ['c', 'url', 'link', 'u', 't', 'goto', 'redirect', 'target', 'ref'];
            const urlParams = new URLSearchParams(window.location.search);
            
            for (let param of params) {
                const value = urlParams.get(param);
                if (value) return value;
            }
            return null;
        }
        
        // Base64è§£ç ï¼ˆè‡ªå®šä¹‰å®ç°ï¼Œæ”¯æŒæ‰€æœ‰å­—èŠ‚å€¼ï¼‰
        function base64Decode(str) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
            const lookup = {};
            for (let i = 0; i < chars.length; i++) {
                lookup[chars[i]] = i;
            }
            
            const bytes = [];
            
            for (let i = 0; i < str.length; i += 4) {
                const a = lookup[str[i]] || 0;
                const b = lookup[str[i + 1]] || 0;
                const c = lookup[str[i + 2]] || 0;
                const d = lookup[str[i + 3]] || 0;
                
                const bitmap = (a << 18) | (b << 12) | (c << 6) | d;
                
                bytes.push((bitmap >> 16) & 255);
                if (str[i + 2] !== '=') bytes.push((bitmap >> 8) & 255);
                if (str[i + 3] !== '=') bytes.push(bitmap & 255);
            }
            
            return bytes;
        }
        
        // ==================== è§£å¯†é™„åŠ å‚æ•°ï¼ˆæ”¯æŒUnicodeï¼‰====================
        function decryptParams(encryptedParams) {
            if (!encryptedParams) return {};
            
            try {
                // è¿˜åŸURLå®‰å…¨çš„Base64
                const base64 = encryptedParams.replace(/-/g, '+').replace(/_/g, '/');
                // è¡¥å……å¯èƒ½ç¼ºå¤±çš„=å·
                const paddedBase64 = base64 + '==='.slice(0, (4 - base64.length % 4) % 4);
                
                // Base64è§£ç ä¸ºå­—èŠ‚æ•°ç»„ï¼ˆä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°ï¼‰
                const encryptedBytes = base64Decode(paddedBase64);
                
                // å°†å¯†é’¥ä¹Ÿè½¬ä¸ºUTF-8å­—èŠ‚æ•°ç»„ï¼ˆå…³é”®ä¿®å¤ï¼ï¼‰
                const encoder = new TextEncoder();
                const keyBytes = encoder.encode(CONFIG.ENCRYPT_KEY);
                
                // XORè§£å¯†å­—èŠ‚æ•°ç»„
                const decryptedBytes = [];
                for (let i = 0; i < encryptedBytes.length; i++) {
                    decryptedBytes.push(
                        encryptedBytes[i] ^ keyBytes[i % keyBytes.length]
                    );
                }
                
                // å­—èŠ‚æ•°ç»„è½¬UTF-8å­—ç¬¦ä¸²
                const decoder = new TextDecoder();
                const result = decoder.decode(new Uint8Array(decryptedBytes));
                
                // è§£æJSON
                return JSON.parse(result);
            } catch (error) {
                console.warn('å‚æ•°è§£å¯†å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼:', error);
                return {};
            }
        }
        
        // ==================== XORè§£å¯† ====================
        function xorDecrypt(str, key) {
            try {
                const decoded = atob(str); // Base64è§£ç 
                let result = '';
                for (let i = 0; i < decoded.length; i++) {
                    result += String.fromCharCode(
                        decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length)
                    );
                }
                return result;
            } catch(e) {
                throw new Error('è§£å¯†å¤±è´¥');
            }
        }
        
        // ==================== ç­¾åéªŒè¯ ====================
        function verifySignature(url, timestamp, signature) {
            const raw = url + timestamp + CONFIG.ENCRYPT_KEY;
            let hash = 0;
            for (let i = 0; i < raw.length; i++) {
                const char = raw.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            const computed = Math.abs(hash).toString(36);
            return computed === signature;
        }
        
        // ==================== æ˜¾ç¤ºé”™è¯¯ ====================
        function showError(message, details = '') {
            const container = document.querySelector('.container');
            const errorIcon = RandomEngine.pick(['âš ï¸', 'âŒ', 'â›”', 'ğŸš«']);
            container.innerHTML = `
                <div class="error">
                    <div class="error-icon">${errorIcon}</div>
                    <h2 style="margin-bottom: 10px;">${message}</h2>
                    ${details ? `<p style="font-size: 13px; opacity: 0.8;">${details}</p>` : ''}
                </div>
            `;
        }
        
        // ==================== æ›´æ–°çŠ¶æ€ï¼ˆä½¿ç”¨éšæœºæ–‡æœ¬ï¼‰ ====================
        function updateStatus(type) {
            const text = window._randomTexts[type] || type;
            document.getElementById('status').textContent = text;
        }
        
        // ==================== æ™ºèƒ½é‡è¯•æœºåˆ¶ ====================
        async function retryRedirect(fn, maxRetries = 3, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await fn();
                } catch (error) {
                    console.warn(`å°è¯• ${i + 1}/${maxRetries} å¤±è´¥:`, error);
                    if (i < maxRetries - 1) {
                        document.getElementById('status').textContent = `æ­£åœ¨é‡è¯•... (${i + 1}/${maxRetries})`;
                        await new Promise(resolve => setTimeout(resolve, delay * (i + 1)));
                    } else {
                        throw error;
                    }
                }
            }
        }
        
        // ==================== ä¸»è·³è½¬é€»è¾‘ ====================
        (async function redirect() {
            try {
                // 1. æ£€æµ‹User-Agent
                const ua = getUserAgent();
                updateStatus('checking');
                
                if (CONFIG.ENABLE_WECHAT_CHECK && !ua.isWeChat && !ua.isQQ) {
                    updateStatus('wechat');
                    // return; // å–æ¶ˆè¿™è¡Œæ³¨é‡Šå¯å¼ºåˆ¶åªå…è®¸å¾®ä¿¡è®¿é—®
                }
                
                // 2. è·å–å¹¶è§£å¯†é™„åŠ å‚æ•°
                const urlParams = new URLSearchParams(window.location.search);
                const encryptedParams = urlParams.get('p');
                
                console.log('ğŸ” åŠ å¯†å‚æ•° p:', encryptedParams);
                
                const additionalParams = decryptParams(encryptedParams);
                
                console.log('ğŸ”“ è§£å¯†å‚æ•°:', additionalParams);
                
                // ä»è§£å¯†åçš„å‚æ•°ä¸­æå–ï¼ˆä¼˜å…ˆï¼‰æˆ–ä»URLä¸­è·å–ï¼ˆå…¼å®¹æ—§é“¾æ¥ï¼‰
                const mode = additionalParams.mode || urlParams.get('mode');
                const requiredEnv = additionalParams.env || urlParams.get('env');
                const apiServer = additionalParams.api || urlParams.get('api');
                
                console.log('âœ… æœ€ç»ˆä½¿ç”¨å‚æ•°:', {
                    mode: mode,
                    env: requiredEnv,
                    api: apiServer
                });
                
                // 3. è·å–åŠ å¯†çš„ä¸»URLå‚æ•°
                updateStatus('parsing');
                const encodedData = getUrlParam();
                
                if (!encodedData) {
                    throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦å®Œæ•´');
                }
                
                // 4. è§£ç URLå‚æ•°
                const decodedParam = decodeURIComponent(encodedData);
                
                // 4. è§£å¯†æ•°æ®
                updateStatus('decrypting');
                const decrypted = xorDecrypt(decodedParam, CONFIG.ENCRYPT_KEY);
                const payload = JSON.parse(decrypted);
                
                // 5. éªŒè¯æ•°æ®ç»“æ„
                if (!payload.u || !payload.t || !payload.s) {
                    throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
                }
                
                const { u, t: timestamp, s: signature, v: version } = payload;
                let targetUrl = u;  // ä½¿ç”¨letä»¥ä¾¿åç»­å¯ä»¥ä¿®æ”¹
                
                // 6. éªŒè¯æ—¶é—´æˆ³ï¼ˆé˜²æ­¢é“¾æ¥è¿‡æœŸï¼‰
                if (CONFIG.ENABLE_EXPIRE_CHECK) {
                    updateStatus('verifying');
                    const now = Date.now();
                    const age = now - timestamp;
                    
                    if (age > CONFIG.LINK_EXPIRE_TIME) {
                        throw new Error('é“¾æ¥å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç”Ÿæˆ');
                    }
                    
                    if (age < -60000) { // æ—¶é—´æˆ³ä¸èƒ½æ˜¯æœªæ¥
                        throw new Error('é“¾æ¥æ—¶é—´å¼‚å¸¸');
                    }
                }
                
                // 7. éªŒè¯ç­¾åï¼ˆä½¿ç”¨åŸå§‹URLï¼‰
                if (CONFIG.ENABLE_SIGNATURE_CHECK) {
                    updateStatus('signature');
                    if (!verifySignature(u, timestamp, signature)) {
                        throw new Error('ç­¾åéªŒè¯å¤±è´¥ï¼Œé“¾æ¥å¯èƒ½å·²è¢«ç¯¡æ”¹');
                    }
                }
                
                // 8. éªŒè¯ç›®æ ‡URLæ ¼å¼
                updateStatus('validating');
                if (!/^https?:\/\//i.test(targetUrl)) {
                    throw new Error('ç›®æ ‡åœ°å€æ ¼å¼é”™è¯¯');
                }
                
                // 8.5 ğŸ”’ è‡ªåŠ¨å‡çº§ HTTP â†’ HTTPSï¼ˆå·²ç¦ç”¨ï¼Œæ”¯æŒ HTTP è·³è½¬ï¼‰
                // æ³¨æ„ï¼šå¦‚æœä¸­è½¬åŸŸåæ˜¯ HTTPSï¼Œç›®æ ‡æ˜¯ HTTPï¼Œæµè§ˆå™¨å¯èƒ½ä¼šæ˜¾ç¤ºæ··åˆå†…å®¹è­¦å‘Š
                // å¦‚éœ€è‡ªåŠ¨å‡çº§ï¼Œå–æ¶ˆä¸‹é¢ä»£ç çš„æ³¨é‡Šï¼š
                /*
                if (window.location.protocol === 'https:' && targetUrl.startsWith('http://')) {
                    const httpsUrl = targetUrl.replace(/^http:\/\//i, 'https://');
                    console.log(`ğŸ”’ æ£€æµ‹åˆ°æ··åˆå†…å®¹ï¼Œè‡ªåŠ¨å‡çº§:\n   HTTP:  ${targetUrl}\n   HTTPS: ${httpsUrl}`);
                    targetUrl = httpsUrl;
                }
                */
                
                // 9. æ˜¾ç¤ºç›®æ ‡åŸŸåï¼ˆå¯é€‰ï¼‰
                try {
                    const hostname = new URL(targetUrl).hostname;
                    document.getElementById('status').textContent = `å³å°†è·³è½¬åˆ° ${hostname}`;
                } catch(e) {
                    document.getElementById('status').textContent = 'å³å°†è·³è½¬...';
                }
                
                //  10. æ£€æŸ¥ç¯å¢ƒé™åˆ¶ï¼ˆä½¿ç”¨è§£å¯†åçš„å‚æ•°ï¼‰
                if (requiredEnv && requiredEnv !== 'all') {
                    const currentEnv = detectCurrentEnvironment();
                    
                    if (currentEnv !== requiredEnv) {
                        // ç¯å¢ƒä¸åŒ¹é…ï¼Œæ˜¾ç¤ºæç¤ºé¡µé¢
                        showEnvironmentRestriction(requiredEnv, currentEnv);
                        return; // ç»ˆæ­¢è·³è½¬
                    }
                }
                
                // 11. ä¸ŠæŠ¥æˆåŠŸç»Ÿè®¡ï¼ˆä½¿ç”¨è§£å¯†åçš„APIæœåŠ¡å™¨åœ°å€ï¼‰
                reportAccess(targetUrl, true, apiServer);
                
                // 12. æ£€æµ‹æ˜¯å¦ä½¿ç”¨iframeåµŒå¥—æ¨¡å¼ï¼ˆä½¿ç”¨è§£å¯†åçš„modeå‚æ•°ï¼‰
                const isIframeMode = mode === 'iframe';
                
                if (isIframeMode) {
                    // ==================== iframeåµŒå¥—æ¨¡å¼ - å¼ºåŠ›é˜²å° ====================
                    // æ›´æ–°çŠ¶æ€æç¤º
                    document.getElementById('status').textContent = 'æ­£åœ¨åŠ è½½å†…å®¹...';
                    
                    // å»¶è¿Ÿä¸€ä¸‹å†æ˜¾ç¤ºiframeï¼ˆæ›´è‡ªç„¶ï¼‰
                    const randomDelay = CONFIG.REDIRECT_DELAY + RandomEngine.int(-200, 200);
                    await new Promise(resolve => setTimeout(resolve, randomDelay));
                    
                    // æ¸…ç©ºé¡µé¢å¹¶åˆ›å»ºiframeå®¹å™¨
                    document.body.innerHTML = '';
                    document.body.style.margin = '0';
                    document.body.style.padding = '0';
                    document.body.style.overflow = 'hidden';
                    
                    const iframe = document.createElement('iframe');
                    iframe.src = targetUrl;
                    iframe.style.cssText = 'width:100%;height:100vh;border:none;position:fixed;top:0;left:0;z-index:999999;';
                    iframe.setAttribute('allowfullscreen', 'true');
                    iframe.setAttribute('allow', 'geolocation; microphone; camera');
                    
                    // å¤„ç†iframeåŠ è½½é”™è¯¯ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰
                    iframe.onerror = function() {
                        document.body.innerHTML = `
                            <div style="display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;text-align:center;font-family:Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);">
                                <div style="background:white;padding:40px;border-radius:12px;max-width:500px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                                    <div style="font-size:64px;margin-bottom:20px;">âš ï¸</div>
                                    <h2 style="color:#333;margin-bottom:15px;">æ— æ³•åœ¨å½“å‰ç¯å¢ƒåŠ è½½</h2>
                                    <p style="color:#666;margin-bottom:25px;">ç›®æ ‡ç½‘ç«™è®¾ç½®äº†å®‰å…¨ç­–ç•¥ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®¿é—®</p>
                                    <a href="${targetUrl}" style="display:inline-block;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px 30px;border-radius:8px;text-decoration:none;font-weight:bold;">ç›´æ¥è®¿é—®</a>
                                </div>
                            </div>
                        `;
                    };
                    
                    document.body.appendChild(iframe);
                    
                    console.log('âœ… iframeåµŒå¥—æ¨¡å¼å·²å¯ç”¨ï¼Œåœ°å€æ æ˜¾ç¤ºä¸­è½¬åŸŸå');
                    
                } else {
                    // ==================== æ™®é€šè·³è½¬æ¨¡å¼ ====================
                    // 12. æ™ºèƒ½é‡è¯•è·³è½¬
                    const startTime = Date.now();
                    await retryRedirect(async () => {
                        // é¢„æ£€æµ‹ç›®æ ‡URLæ˜¯å¦å¯è¾¾
                        try {
                            await fetch(new URL(targetUrl).origin, { 
                                method: 'HEAD', 
                                mode: 'no-cors',
                                cache: 'no-cache'
                            });
                        } catch(e) {
                            console.warn('ç›®æ ‡å¯è¾¾æ€§æ£€æµ‹å¤±è´¥ï¼Œä½†ç»§ç»­è·³è½¬');
                        }
                        
                        // è®°å½•å“åº”æ—¶é—´
                        const responseTime = Date.now() - startTime;
                        
                        // ä¸ŠæŠ¥åŸŸåå¥åº·
                        try {
                            const domain = new URL(targetUrl).origin;
                            reportDomainHealth(domain, true, responseTime);
                        } catch(e) {}
                        
                        // éšæœºå»¶è¿Ÿè·³è½¬ï¼ˆå¢åŠ ä¸å¯é¢„æµ‹æ€§ï¼‰
                        const randomDelay = CONFIG.REDIRECT_DELAY + RandomEngine.int(-200, 200);
                        await new Promise(resolve => setTimeout(resolve, randomDelay));
                        
                        // è·³è½¬æ–¹å¼1ï¼šç›´æ¥è·³è½¬ï¼ˆæ¨èï¼‰
                        window.location.href = targetUrl;
                        
                        // è·³è½¬æ–¹å¼2ï¼šreplaceè·³è½¬ï¼ˆä¸ç•™å†å²è®°å½•ï¼‰
                        // window.location.replace(targetUrl);
                        
                        return true;
                    }, 3, 2000); // æœ€å¤šé‡è¯•3æ¬¡ï¼Œæ¯æ¬¡å»¶è¿Ÿ2ç§’
                }
                
            } catch(error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                
                // ä¸ŠæŠ¥å¤±è´¥ç»Ÿè®¡
                reportAccess('', false);
                
                showError(error.message || 'é“¾æ¥è§£æå¤±è´¥', 'è¯·ç¡®è®¤é“¾æ¥æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è”ç³»ç®¡ç†å‘˜');
            }
        })();
        
        // ==================== æ£€æµ‹å½“å‰ç¯å¢ƒ ====================
        function detectCurrentEnvironment() {
            const ua = navigator.userAgent;
            const uaLower = ua.toLowerCase();
            
            // å¾®ä¿¡æ£€æµ‹
            if (ua.indexOf('MicroMessenger') !== -1) {
                return 'weixin';
            }
            
            // QQæ£€æµ‹ï¼ˆå¤šç§è¯†åˆ«æ–¹å¼ï¼‰
            if (ua.indexOf('QQ/') !== -1 
                || uaLower.indexOf('mqqbrowser') !== -1
                || ua.indexOf('Tim/') !== -1
                || uaLower.indexOf('qzone') !== -1) {
                return 'qq';
            }
            
            // å…¶ä»–éƒ½è®¤ä¸ºæ˜¯æµè§ˆå™¨
            return 'browser';
        }
        
        // ==================== æ˜¾ç¤ºç¯å¢ƒé™åˆ¶æç¤º ====================
        function showEnvironmentRestriction(requiredEnv, currentEnv) {
            const envNames = {
                'weixin': 'ğŸ’¬ å¾®ä¿¡',
                'qq': 'ğŸ§ QQ',
                'browser': 'ğŸŒ æµè§ˆå™¨'
            };
            
            const envColors = {
                'weixin': '#07c160',
                'qq': '#12b7f5',
                'browser': '#667eea'
            };
            
            const requiredName = envNames[requiredEnv] || 'æœªçŸ¥';
            const currentName = envNames[currentEnv] || 'æœªçŸ¥';
            const primaryColor = envColors[requiredEnv] || '#667eea';
            
            let steps = '';
            if (requiredEnv === 'weixin') {
                steps = `
                    <div class="steps">
                        <h3>ğŸ“± å¦‚ä½•åœ¨å¾®ä¿¡ä¸­æ‰“å¼€ï¼Ÿ</h3>
                        <ol>
                            <li>é•¿æŒ‰æ­¤é“¾æ¥ï¼Œé€‰æ‹©"å¤åˆ¶"</li>
                            <li>æ‰“å¼€å¾®ä¿¡APP</li>
                            <li>åœ¨ä»»æ„èŠå¤©çª—å£ç²˜è´´é“¾æ¥</li>
                            <li>ç‚¹å‡»é“¾æ¥å³å¯è®¿é—®</li>
                        </ol>
                    </div>
                `;
            } else if (requiredEnv === 'qq') {
                steps = `
                    <div class="steps">
                        <h3>ğŸ§ å¦‚ä½•åœ¨QQä¸­æ‰“å¼€ï¼Ÿ</h3>
                        <ol>
                            <li>é•¿æŒ‰æ­¤é“¾æ¥ï¼Œé€‰æ‹©"å¤åˆ¶"</li>
                            <li>æ‰“å¼€QQ APP</li>
                            <li>åœ¨ä»»æ„èŠå¤©çª—å£ç²˜è´´é“¾æ¥</li>
                            <li>ç‚¹å‡»é“¾æ¥å³å¯è®¿é—®</li>
                        </ol>
                    </div>
                `;
            } else if (requiredEnv === 'browser') {
                steps = `
                    <div class="steps">
                        <h3>ğŸŒ å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Ÿ</h3>
                        <ol>
                            <li>ç‚¹å‡»å³ä¸Šè§’"..."èœå•</li>
                            <li>é€‰æ‹©"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"</li>
                            <li>æˆ–å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨åœ°å€æ è®¿é—®</li>
                        </ol>
                    </div>
                `;
            }
            
            document.body.innerHTML = `
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
                        background: linear-gradient(135deg, ${primaryColor} 0%, #764ba2 100%);
                        min-height: 100vh;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 20px;
                    }
                    .container {
                        background: rgba(255, 255, 255, 0.95);
                        border-radius: 20px;
                        padding: 40px 30px;
                        max-width: 400px;
                        text-align: center;
                        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                        animation: slideUp 0.5s ease;
                    }
                    @keyframes slideUp {
                        from { opacity: 0; transform: translateY(30px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .icon {
                        font-size: 80px;
                        margin-bottom: 20px;
                        animation: bounce 2s infinite;
                    }
                    @keyframes bounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }
                    h1 { color: #1e293b; font-size: 24px; margin-bottom: 15px; }
                    .message { color: #64748b; font-size: 16px; line-height: 1.8; margin-bottom: 25px; }
                    .env-info {
                        background: #f1f5f9;
                        border-radius: 12px;
                        padding: 20px;
                        margin-bottom: 25px;
                    }
                    .env-item {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                        margin: 10px 0;
                        font-size: 16px;
                    }
                    .env-item.current { color: #ef4444; }
                    .env-item.required { color: #10b981; font-weight: bold; }
                    .tip { color: #94a3b8; font-size: 14px; line-height: 1.6; }
                    .steps {
                        text-align: left;
                        background: #f8fafc;
                        border-radius: 10px;
                        padding: 20px;
                        margin-top: 20px;
                    }
                    .steps h3 { color: #475569; font-size: 16px; margin-bottom: 12px; }
                    .steps ol { margin-left: 20px; color: #64748b; }
                    .steps li { margin: 8px 0; }
                </style>
                <div class="container">
                    <div class="icon">${requiredName.split(' ')[0]}</div>
                    <h1>è®¿é—®ç¯å¢ƒä¸åŒ¹é…</h1>
                    <div class="message">æ­¤é“¾æ¥éœ€è¦åœ¨ç‰¹å®šç¯å¢ƒä¸­æ‰“å¼€</div>
                    <div class="env-info">
                        <div class="env-item current">
                            <span>${currentName.split(' ')[0]}</span>
                            <span>å½“å‰ç¯å¢ƒï¼š${currentName.split(' ')[1] || currentName}</span>
                        </div>
                        <div class="env-item required">
                            <span>${requiredNameã€‚split(' ')[0]}</span>
                            <span>éœ€è¦ç¯å¢ƒï¼š${requiredName.split(' ')[1] || requiredName}</span>
                        </div>
                    </div>
                    ${steps}
                    <div class="tip" style="margin-top: 20px;">ğŸ’¡ å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»é“¾æ¥æä¾›è€…</div>
                </div>
            `;
        }
        
        // ==================== è·å–APIæœåŠ¡å™¨åœ°å€ ====================
        function getApiServer() {
            // ä»URLå‚æ•°ä¸­è·å–APIæœåŠ¡å™¨åœ°å€
            const urlParams = new URLSearchParams(window.location.search);
            const apiServer = urlParamsã€‚get('api');
            
            // å¦‚æœæœ‰APIå‚æ•°ï¼Œä½¿ç”¨å®ƒï¼›å¦åˆ™å°è¯•ç›¸å¯¹è·¯å¾„ï¼ˆä»…é€‚ç”¨äºPHPæœåŠ¡å™¨ï¼‰
            return apiServer || null;
        }
        
        // ==================== ç»Ÿè®¡ä¸ŠæŠ¥ ====================
        function reportAccess(targetUrl = '', success = true, customApiServer = null) {
            try {
                // ä¼˜å…ˆä½¿ç”¨ä¼ å…¥çš„APIæœåŠ¡å™¨åœ°å€ï¼Œå¦åˆ™ä»URLè·å–
                const apiServer = customApiServer || getApiServer();
                if (!apiServer) {
                    // æ²¡æœ‰é…ç½®APIæœåŠ¡å™¨ï¼Œè·³è¿‡ç»Ÿè®¡ï¼ˆCOSæ¨¡å¼ï¼‰
                    return;
                }
                
                const ua = getUserAgent();
                fetch(`${apiServer}/stats.php?action=log`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSONã€‚stringify({
                        url: targetUrl,
                        ua: navigator.userAgentï¼Œ
                        ref: documentã€‚referrer,
                        success: success ? 1 : 0,
                        time: Date.now()
                    }),
                    keepalive: true
                })ã€‚catch(() => {
                    // é™é»˜å¤±è´¥ï¼Œä¸å½±å“è·³è½¬
                });
            } catch(e) {
                // å¿½ç•¥ç»Ÿè®¡é”™è¯¯
            }
        }
        
        // ==================== åŸŸåå¥åº·ä¸ŠæŠ¥ ====================
        function reportDomainHealth(domainï¼Œ success, responseTime) {
            try {
                const apiServer = getApiServer();
                if (!apiServer) {
                    // æ²¡æœ‰é…ç½®APIæœåŠ¡å™¨ï¼Œè·³è¿‡ä¸ŠæŠ¥
                    return;
                }
                
                fetch(`${apiServer}/stats.php?action=report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        domain: domain,
                        success: success ? 1 : 0,
                        response_time: responseTime
                    })ï¼Œ
                    keepalive: true
                }).catch(() => {});
            } catch(e) {
                // å¿½ç•¥é”™è¯¯
            }
        }
    </script>
</body>
</html>
